<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O.O Sleep - UI v12</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Design Tokens */
        :root {
            --color-bg-primary: #23255A; --color-brand-purple: #6C63FF;
            --color-soft-blue: #78A6FF; --color-cloud-blue: #9EC6FF;
            --color-starlight-blue: #B8D1FF; --color-success: #4CD964;
            --color-text-primary: #EDEFF7; --color-text-secondary: #B9BED5;
            --color-text-weak: #8B90A6; --color-text-inverted: #0E0F2D;
            --color-card-bg: #1a1c4a; --color-card-border: #3B3F7A;
            --brand-grad: linear-gradient(180deg, #9EC6FF 0%, #6C63FF 100%);
            --radius-card: 20px; --radius-button: 14px;
            --shadow-card: 0 8px 24px 0 rgba(20,24,74,0.18);
        }
        body { font-family: 'SF Pro', 'PingFang SC', 'Noto Sans SC', sans-serif; background-color: var(--color-bg-primary); color: var(--color-text-primary); }
        .phone-mockup { max-width: 420px; height: 880px; }
        .screen { display: none; animation: fadeIn 0.3s; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* Typography */
        .text-h1 { font-size: 32px; line-height: 1.2; font-weight: 700; }
        .text-h2 { font-size: 24px; line-height: 1.25; font-weight: 700; }
        .text-title { font-size: 20px; line-height: 1.3; font-weight: 700; }
        .text-body { font-size: 16px; line-height: 1.5; }
        .text-caption { font-size: 13px; line-height: 1.4; color: var(--color-text-secondary); }
        /* Components */
        .card { background-color: var(--color-card-bg); border-radius: var(--radius-card); padding: 16px; box-shadow: var(--shadow-card); position: relative; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: rgba(255,255,255,0.15); border-radius: var(--radius-card) var(--radius-card) 0 0; }
        .btn { height: 56px; padding: 0 20px; border-radius: var(--radius-button); font-weight: 700; display: inline-flex; align-items: center; justify-content: center; transition: all 0.1s ease-out; }
        .btn:active { transform: scale(0.98); filter: brightness(0.94); }
        .btn-primary { background: var(--brand-grad); color: var(--color-text-inverted); }
        .btn-secondary { background-color: #31336F; border: 1px solid var(--color-card-border); color: var(--color-text-primary); }
        .ios-list { background-color: var(--color-card-bg); border-radius: 12px; }
        .ios-list-item { display: flex; align-items: center; padding: 12px 16px; border-bottom: 1px solid rgba(139, 144, 166, 0.2); }
        .ios-list-item:last-child { border-bottom: none; }
        .ios-list-icon { width: 30px; height: 30px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 16px; }
        .nav-item.active .nav-icon { transform: scale(1.1); color: var(--color-brand-purple); }
        .nav-item.active .nav-label { color: var(--color-brand-purple); }
        .modal-sheet { position: absolute; bottom: 0; left: 0; right: 0; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); z-index: 50; background: #1E2235; backdrop-filter: blur(20px); }
        .modal-sheet.show { transform: translateY(0); }
        .modal-overlay { position: absolute; inset: 0; background-color: rgba(0,0,0,0.4); opacity: 0; transition: opacity 0.4s ease; pointer-events: none; z-index: 40; }
        .modal-overlay.show { opacity: 1; pointer-events: auto; }
        .breathing-pet { animation: breathing 6s ease-in-out infinite; }
        @keyframes breathing { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
        .tab-btn.active { background-color: var(--color-soft-blue); color: var(--color-text-inverted); }
        .onboarding-screen { display: none; }
        .onboarding-screen.active { display: flex; }
        .goal-option { background-color: var(--color-card-bg); border: 2px solid var(--color-card-border); transition: all 0.2s ease; }
        .goal-option.selected { border-color: var(--color-brand-purple); background-color: rgba(108, 99, 255, 0.2); }
    </style>
</head>
<body class="bg-gray-800 flex items-center justify-center min-h-screen p-4">
    <div class="phone-mockup w-full rounded-[40px] border-[10px] border-gray-700 shadow-2xl overflow-hidden relative flex flex-col bg-[var(--color-bg-primary)]">
        
        <div id="modal-overlay" class="modal-overlay" onclick="hideAllModals()"></div>

        <main class="flex-grow overflow-y-auto">
            <!-- Onboarding Flow -->
            <div id="onboarding-flow" class="screen active h-full">
                <!-- Step 0: Language Selection -->
                <div id="onboarding-language" class="onboarding-screen active h-full p-8 text-white flex-col justify-center items-center text-center">
                    <img src="images/Logo.png" alt="O.O Sleep Logo" class="w-48 mx-auto rounded-[36px]">
                    <h1 class="text-h1 mt-8">Welcome</h1>
                    <div class="w-full space-y-4 mt-12">
                         <button onclick="setLanguage('zh')" class="btn btn-secondary w-full">ä¸­æ–‡</button>
                         <button onclick="setLanguage('en')" class="btn btn-secondary w-full">English</button>
                    </div>
                </div>

                <!-- Step 1: Welcome -->
                <div id="onboarding-welcome" class="onboarding-screen h-full p-8 text-white flex-col justify-between text-center">
                    <div></div>
                    <div>
                        <img src="images/Logo.png" alt="O.O Sleep Logo" class="w-48 mx-auto rounded-[36px]">
                        <h1 class="text-h1 mt-8">O.O Sleep</h1>
                        <p class="text-body mt-2 text-[var(--color-text-secondary)]" data-lang="onboarding_welcome_slogan">Your Sleep, Its Growth Story</p>
                    </div>
                    <button onclick="nextOnboardingStep('onboarding-permissions')" class="btn btn-primary w-full" data-lang="onboarding_start_journey">å¼€å¯æ—…ç¨‹</button>
                </div>

                <!-- Step 2: Permissions -->
                <div id="onboarding-permissions" class="onboarding-screen h-full p-8 text-white flex-col justify-between text-center">
                    <div></div>
                    <div id="permission-mic" class="w-full">
                        <div class="w-24 h-24 bg-purple-500/20 rounded-full mx-auto flex items-center justify-center"><i data-lucide="mic" class="w-12 h-12 text-purple-300"></i></div>
                        <h2 class="text-h2 mt-6" data-lang="onboarding_mic_title">éº¦å…‹é£æƒé™</h2>
                        <p class="text-body mt-2 text-[var(--color-text-secondary)]" data-lang="onboarding_mic_desc">O.O éœ€è¦éº¦å…‹é£æ¥å€¾å¬ä½ çš„æ¢¦è¯ä¸å‘¼å™œï¼Œä¸ºä½ ç”Ÿæˆæœ‰è¶£çš„ç¡çœ æŠ¥å‘Šã€‚</p>
                    </div>
                     <div id="permission-notify" class="w-full hidden">
                        <div class="w-24 h-24 bg-blue-500/20 rounded-full mx-auto flex items-center justify-center"><i data-lucide="bell" class="w-12 h-12 text-blue-300"></i></div>
                        <h2 class="text-h2 mt-6" data-lang="onboarding_notify_title">é€šçŸ¥æƒé™</h2>
                        <p class="text-body mt-2 text-[var(--color-text-secondary)]" data-lang="onboarding_notify_desc">å…è®¸æˆ‘ä»¬å‘é€ç¡å‰æé†’ï¼Œè®© O.O å‡†æ—¶é™ªä½ å…¥ç¡ã€‚</p>
                    </div>
                    <button id="permission-button" onclick="grantPermissions()" class="btn btn-primary w-full" data-lang="onboarding_auth_button">æˆæƒ</button>
                </div>
                
                <!-- Step 3: Pet Selection -->
                <div id="onboarding-pet" class="onboarding-screen h-full p-8 text-white flex-col justify-between text-center">
                    <div></div>
                    <div>
                        <h2 class="text-h2" data-lang="onboarding_pet_title">ä½ çš„ç¡çœ ä¼™ä¼´</h2>
                        <img src="images/panda.jpg" alt="ç†ŠçŒ«å®‰å®‰" class="w-48 my-8 mx-auto breathing-pet rounded-[36px]">
                        <p class="text-body text-[var(--color-text-secondary)]" data-lang="onboarding_pet_desc">ä¸ºä½ çš„ç†ŠçŒ«ä¼™ä¼´å–ä¸ªåå­—å§</p>
                        <input id="pet-name-input" type="text" value="å®‰å®‰" class="w-full text-center bg-transparent border-b-2 border-gray-500 text-h1 py-2 mt-2 focus:border-white focus:outline-none">
                    </div>
                    <button onclick="nextOnboardingStep('onboarding-goals')" class="btn btn-primary w-full" data-lang="onboarding_pet_button">å°±å«è¿™ä¸ªï¼</button>
                </div>

                <!-- Step 4: Goal Setting -->
                <div id="onboarding-goals" class="onboarding-screen h-full p-8 text-white flex-col justify-between text-left">
                    <div class="w-full">
                        <h2 class="text-h2 text-center" data-lang="onboarding_goals_title">è®¾å®šä½ çš„ç›®æ ‡</h2>
                        <p class="text-body mt-8 font-bold" data-lang="onboarding_goals_q1">ä½ ä¸»è¦çš„ç¡çœ å›°æ‰°æ˜¯ï¼Ÿ</p>
                        <div class="grid grid-cols-2 gap-4 mt-4">
                            <div class="goal-option p-4 rounded-lg cursor-pointer" onclick="toggleGoal(this)"><p data-lang="onboarding_goals_o1">å…¥ç¡å›°éš¾</p></div>
                            <div class="goal-option p-4 rounded-lg cursor-pointer" onclick="toggleGoal(this)"><p data-lang="onboarding_goals_o2">ç¡çœ æµ…</p></div>
                            <div class="goal-option p-4 rounded-lg cursor-pointer" onclick="toggleGoal(this)"><p data-lang="onboarding_goals_o3">å®¹æ˜“é†’</p></div>
                            <div class="goal-option p-4 rounded-lg cursor-pointer" onclick="toggleGoal(this)"><p data-lang="onboarding_goals_o4">å¤šæ¢¦</p></div>
                        </div>
                        <p class="text-body mt-8 font-bold" data-lang="onboarding_goals_q2">ä½ çš„ç›®æ ‡å…¥ç¡æ—¶é—´æ˜¯ï¼Ÿ</p>
                        <input type="time" value="23:00" class="w-full bg-transparent text-h1 mt-2 p-2 rounded-lg border-2 border-[var(--color-card-border)]">
                    </div>
                    <button onclick="nextOnboardingStep('onboarding-intro')" class="btn btn-primary w-full" data-lang="onboarding_goals_button">å®Œæˆè®¾å®š</button>
                </div>
                
                <!-- Step 5: Core Intro -->
                <div id="onboarding-intro" class="onboarding-screen h-full p-8 text-white flex-col justify-between text-center">
                    <div></div>
                    <div>
                        <img src="images/panda.jpg" alt="å¯çˆ±çš„ç†ŠçŒ«ç¡çœ Appå›¾æ ‡" class="w-48 mx-auto breathing-pet rounded-[36px]">
                        <h1 id="intro-title" class="text-h1 mt-8" data-lang="onboarding_intro_greeting">ä½ å¥½ï¼æˆ‘æ˜¯å®‰å®‰</h1>
                        <p class="text-body mt-4 text-[var(--color-text-secondary)]" data-lang="onboarding_intro_desc">é€šè¿‡é«˜è´¨é‡çš„ç¡çœ ï¼Œ<br>ä½ å°†è·å¾—æ˜Ÿæ˜Ÿï¼Œå¸®åŠ©æˆ‘æˆé•¿ï¼</p>
                    </div>
                    <button onclick="finishOnboarding()" class="btn btn-primary w-full" data-lang="onboarding_intro_button">å¼€å§‹ä½¿ç”¨</button>
                </div>
            </div>
            
            <!-- B. Home (å® ç‰©ä¸»é¡µ) -->
            <div id="home" class="screen h-full p-6 text-white flex-col">
                <div class="flex justify-between items-center relative z-10">
                    <div class="flex items-center gap-2 bg-black/20 px-3 py-1.5 rounded-full"><i data-lucide="star" class="w-5 h-5 text-yellow-300 fill-yellow-400"></i><span class="font-bold text-white text-body">1,640</span></div>
                    <div class="flex items-center gap-4"><button onclick="navigate('notifications')"><i data-lucide="bell" class="text-[var(--color-starlight-blue)]"></i></button><button onclick="navigate('settings')"><i data-lucide="settings" class="text-[var(--color-starlight-blue)]"></i></button></div>
                </div>
                
                <div id="pet-display-area" class="flex-grow flex flex-col items-center justify-center text-center -mt-8 relative transition-all duration-500 rounded-3xl p-4">
                    <div class="relative">
                        <img src="images/panda.jpg" alt="å¯çˆ±çš„ç†ŠçŒ«ç¡çœ Appå›¾æ ‡" class="w-64 breathing-pet rounded-[48px]" onclick="navigate('pet-customization')">
                        <div id="prop-overlay-container" class="absolute inset-0 flex items-center justify-center pointer-events-none"></div>
                    </div>
                    <h2 id="home-pet-name" class="text-h2 mt-4" data-lang="home_pet_status">å®‰å®‰ æ­£åœ¨ä¼‘æ¯</h2>
                    <button onclick="showPropsModal()" class="absolute bottom-4 left-4 bg-black/20 backdrop-blur-sm rounded-full w-12 h-12 p-0 flex items-center justify-center shadow-lg hover:bg-black/40 transition-colors">
                        <i data-lucide="shirt" class="w-6 h-6 text-white"></i>
                    </button>
                    <button onclick="showBackgroundModal()" class="absolute bottom-4 right-4 bg-black/20 backdrop-blur-sm rounded-full w-12 h-12 p-0 flex items-center justify-center shadow-lg hover:bg-black/40 transition-colors">
                        <i data-lucide="image" class="w-6 h-6 text-white"></i>
                    </button>
                </div>
                
                <div class="space-y-3 mt-4">
                     <div class="card w-full p-4 relative overflow-hidden" style="background: linear-gradient(135deg, #f97316 0%, #4f46e5 100%);" onclick="navigate('store')">
                        <div class="relative z-10">
                            <h3 class="text-title font-bold text-white" data-lang="home_halloween_title">ä¸‡åœ£èŠ‚é™å®šè£…æ‰®</h3>
                            <p class="text-caption text-white/80" data-lang="home_halloween_desc">ç‚¹å‡»æŸ¥çœ‹ O.O çš„æ–°è¡£æœï¼</p>
                        </div>
                        <i data-lucide="ghost" class="absolute -right-4 -bottom-6 w-28 h-28 text-black/20 opacity-70 rotate-[-15deg]"></i>
                    </div>
                    <button onclick="showSleepModal()" class="btn btn-primary w-full"><i data-lucide="power" class="mr-2"></i><span data-lang="home_start_sleep">å¼€å§‹ç¡çœ </span></button>
                </div>
            </div>
            
            <!-- Sleep Center (Tab 2) -->
            <div id="sleep" class="screen h-full p-6 text-white flex-col overflow-y-auto space-y-6">
                <h1 class="text-h2" data-lang="sleep_title">ç¡çœ ä¸­å¿ƒ</h1>
                <div><div class="flex justify-between items-center mb-3"><h2 class="text-title" data-lang="sleep_calendar_title">ç¡çœ æ—¥å†</h2><div class="flex items-center gap-3 text-caption"><span class="flex items-center gap-1.5"><div class="w-2 h-2 rounded-full bg-[var(--color-brand-purple)]"></div><span data-lang="sleep_legend_excellent">ä¼˜ç§€</span></span><span class="flex items-center gap-1.5"><div class="w-2 h-2 rounded-full bg-[var(--color-soft-blue)]"></div><span data-lang="sleep_legend_good">è‰¯å¥½</span></span><span class="flex items-center gap-1.5"><div class="w-2 h-2 rounded-full bg-gray-500"></div><span data-lang="sleep_legend_fair">ä¸€èˆ¬</span></span></div></div><div class="card p-4"><div class="flex justify-between items-center mb-3"><i data-lucide="chevron-left" class="text-[var(--color-text-weak)]"></i><p class="font-bold">2025å¹´ 10æœˆ</p><i data-lucide="chevron-right" class="text-[var(--color-text-weak)]"></i></div><div id="calendar-grid" class="grid grid-cols-7 gap-y-2 text-center text-sm"></div></div></div>
                <div><h2 class="text-title mb-3" data-lang="sleep_noise_title">ç™½å™ªéŸ³</h2><div id="noise-options-container" class="flex gap-4 overflow-x-auto pb-2 -mx-6 px-6"><div data-noise-id="none" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-transparent"><i data-lucide="volume-x" class="w-8 h-8 text-gray-400"></i><p class="mt-2 text-sm font-bold" data-lang="noise_none">æ— </p></div><div data-noise-id="rain" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-[var(--color-brand-purple)]"><i data-lucide="cloud-rain" class="w-8 h-8 text-blue-300"></i><p class="mt-2 text-sm font-bold" data-lang="noise_rain">é›¨å¤œ</p></div><div data-noise-id="wind" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-transparent"><i data-lucide="wind" class="w-8 h-8 text-gray-300"></i><p class="mt-2 text-sm" data-lang="noise_wind">é£å£°</p></div><div data-noise-id="waves" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-transparent"><i data-lucide="waves" class="w-8 h-8 text-cyan-300"></i><p class="mt-2 text-sm" data-lang="noise_waves">æµ·æµª</p></div><div data-noise-id="fire" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-transparent"><i data-lucide="flame" class="w-8 h-8 text-orange-300"></i><p class="mt-2 text-sm" data-lang="noise_fire">ç¯ç«</p></div><div data-noise-id="train" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-transparent"><i data-lucide="train-track" class="w-8 h-8 text-gray-400"></i><p class="mt-2 text-sm" data-lang="noise_train">åˆ—è½¦</p></div></div></div>
                <div class="card" onclick="navigate('routine-planner')"><div class="flex items-center"><div class="ios-list-icon bg-purple-500"><i data-lucide="calendar-clock"></i></div><div><p class="text-body font-bold" data-lang="sleep_routine_title">ä½œæ¯ç®¡ç†</p><p class="text-caption" data-lang="sleep_routine_desc">O.O çš„ä¸“å±åŠ¨ç”»æé†’</p></div><i data-lucide="chevron-right" class="ml-auto text-[var(--color-text-weak)]"></i></div></div>
            </div>
            
            <!-- Competing Screen -->
            <div id="competing" class="screen h-full p-6 text-white flex-col"><div class="flex justify-between items-center mb-6"><h1 class="text-h2" data-lang="compete_title">ç¡çœ ç«èµ›</h1><button onclick="navigate('badge-gallery')"><i data-lucide="award" class="text-[var(--color-starlight-blue)] w-6 h-6"></i></button></div><div class="flex bg-black/20 p-1 rounded-lg mb-4" id="leaderboard-tabs"><button class="tab-btn active flex-1 p-2 rounded-md text-sm font-bold" data-lang="compete_friends">å¥½å‹</button><button class="tab-btn flex-1 p-2 rounded-md text-sm font-bold" data-lang="compete_global">å…¨çƒ</button></div><div class="card p-4 space-y-3"><div class="flex items-center gap-4"><span class="text-xl w-6 text-center">ğŸ¥‡</span><img src="https://placehold.co/40x40/FBBF24/0E0F2D?text=ğŸ±" alt="Aliceçš„å® ç‰©" class="w-10 h-10 rounded-full"><p class="text-body font-bold flex-grow">Alice</p><p class="text-lg font-semibold">95<span data-lang="compete_score_unit">åˆ†</span></p></div><div class="flex items-center gap-4"><span class="text-xl w-6 text-center">ğŸ¥ˆ</span><img src="images/panda.jpg" alt="ä½ çš„ç†ŠçŒ«å® ç‰©" class="w-10 h-10 rounded-full object-cover bg-white/10 p-0.5"><p class="text-body font-bold flex-grow" data-lang="compete_you">ä½ </p><p class="text-lg font-semibold">88<span data-lang="compete_score_unit">åˆ†</span></p></div><div class="flex items-center gap-4"><span class="text-xl w-6 text-center">ğŸ¥‰</span><img src="https://placehold.co/40x40/F87171/0E0F2D?text=ğŸ¦Š" alt="Bobçš„å® ç‰©" class="w-10 h-10 rounded-full"><p class="text-body font-bold flex-grow">Bob</p><p class="text-lg font-semibold">85<span data-lang="compete_score_unit">åˆ†</span></p></div></div><div class="card mt-6 p-4 text-center"><h3 class="text-title" data-lang="compete_team_title">å¥½å‹ç»„é˜Ÿç¡çœ </h3><p class="text-caption mt-1 mb-4" data-lang="compete_team_desc">é‚€è¯·å¥½å‹ä¸€èµ·å®Œæˆç›®æ ‡ï¼Œèµ¢å–é¢å¤–å¥–åŠ±ï¼</p><button class="btn btn-secondary w-full"><i data-lucide="users" class="mr-2"></i><span data-lang="compete_team_button">åˆ›å»ºé˜Ÿä¼</span></button></div></div>
            
            <!-- In Sleep -->
            <div id="in-sleep" class="screen h-full bg-[#000] text-white p-6 flex-col items-center justify-center relative">
                 <img src="images/panda.jpg" alt="æ²‰ç¡ä¸­çš„ç†ŠçŒ«" class="w-48 breathing-pet opacity-80 rounded-[36px]">
                 <div class="flex justify-around w-full max-w-xs mt-8">
                     <div class="text-center">
                         <p class="text-caption" data-lang="insleep_your_hr">ä½ çš„å¿ƒç‡</p>
                         <div class="flex items-center justify-center gap-2 mt-1">
                             <i data-lucide="heart-pulse" class="w-6 h-6 text-red-400 animate-pulse"></i>
                             <p id="user-heart-rate" class="text-h2 font-bold" style="font-variant-numeric: tabular-nums;">--</p>
                         </div>
                     </div>
                     <div class="text-center">
                         <p class="text-caption" data-lang="insleep_pet_hr">O.Oçš„å¿ƒç‡</p>
                         <div class="flex items-center justify-center gap-2 mt-1">
                             <i data-lucide="heart-pulse" class="w-6 h-6 text-purple-400 animate-pulse"></i>
                             <p id="pet-heart-rate" class="text-h2 font-bold" style="font-variant-numeric: tabular-nums;">--</p>
                         </div>
                     </div>
                 </div>
                 <div class="absolute bottom-24 text-center">
                      <p class="text-h1" id="sleep-timer" style="font-variant-numeric: tabular-nums;">00:00:00</p>
                      <p class="text-body text-[var(--color-text-weak)]" data-lang="insleep_recording">æ­£åœ¨è®°å½•ç¡çœ ...</p>
                 </div>
                  <button onclick="endSleep()" class="absolute bottom-10 bg-red-500/50 backdrop-blur-sm text-white font-bold py-4 px-8 rounded-full" data-lang="insleep_end_button">é•¿æŒ‰ç»“æŸ</button>
            </div>

            <!-- Morning Summary -->
            <div id="morning-summary" class="screen h-full p-6 text-white flex-col overflow-y-auto space-y-4">
                <div class="text-center pt-4">
                    <img src="images/panda.jpg" class="w-24 mx-auto rounded-[24px]" alt="Stretching Pet">
                    <h1 class="text-h1 mt-4" data-lang="summary_greeting">æ—©ä¸Šå¥½ï¼</h1>
                    <p class="text-body text-[var(--color-text-secondary)]" data-lang="summary_subtitle">O.O é™ªä½ åº¦è¿‡äº†åˆä¸€ä¸ªå®‰ç¨³çš„å¤œæ™šã€‚</p>
                </div>
                <div class="card text-center">
                    <p class="text-caption" data-lang="summary_reward_title">æœ¬æ¬¡ç¡çœ è·å¾—</p>
                    <div class="flex items-center justify-center gap-2 mt-2">
                        <i data-lucide="star" class="w-8 h-8 text-yellow-300 fill-yellow-400"></i>
                        <span class="text-h1 font-bold text-white">+360</span>
                        <span class="text-xs bg-yellow-500/30 text-yellow-300 font-bold px-1.5 py-0.5 rounded-md">x3</span>
                    </div>
                </div>
                <div class="card w-full p-4 space-y-4">
                    <div class="flex justify-between items-baseline"><span class="text-title" data-lang="summary_score_label">ç¡çœ åˆ†æ•°</span><span class="text-h1">88<span class="text-sm" data-lang="summary_score_unit">åˆ†</span></span></div>
                    <div class="flex justify-between items-baseline"><span class="text-body" data-lang="summary_duration_label">ç¡çœ æ—¶é•¿</span><span class="text-h2">8h 15m</span></div>
                    <div class="flex justify-between items-baseline"><span class="text-body" data-lang="summary_deep_sleep_label">æ·±ç¡å æ¯”</span><span class="text-h2">25%</span></div>
                </div>
                <div class="card w-full p-4">
                    <div class="flex items-center mb-4">
                        <div class="ios-list-icon bg-red-500"><i data-lucide="mic"></i></div>
                        <div>
                            <p class="text-body font-bold" data-lang="summary_sleeptalk_title">æ¢¦è¯ä¸å‘¼å™œ</p>
                            <p class="text-caption" data-lang="summary_sleeptalk_subtitle">O.O å¬åˆ°äº†è¿™äº›...</p>
                        </div>
                    </div>
                    <div class="bg-purple-900/50 rounded-lg p-3 mb-4 relative">
                         <p class="text-sm italic" data-lang="summary_sleeptalk_feedback">"ä¸»äººï¼Œä½ æ˜¨æ™šå¥½åƒåœ¨è¯´'å†æ¥ä¸€ä¸ªç”œç”œåœˆ'...å¬å¾—æˆ‘éƒ½é¥¿äº†ï¼ğŸ˜´"</p>
                         <div class="absolute -bottom-2 left-4 w-0 h-0 border-l-8 border-l-transparent border-r-8 border-r-transparent border-t-8 border-t-purple-900/50"></div>
                    </div>
                    <div class="ios-list !bg-transparent !rounded-none -mx-4 -mb-4">
                        <div class="ios-list-item border-t border-t-white/10"><div class="ios-list-icon bg-red-400/50"><i data-lucide="play"></i></div><div><p data-lang="summary_recording_1">å½•éŸ³ 1: "...å†æ¥ä¸€ä¸ª..."</p><p class="text-caption">02:34 AM Â· 8ç§’</p></div></div>
                        <div class="ios-list-item"><div class="ios-list-icon bg-red-400/50"><i data-lucide="play"></i></div><div><p data-lang="summary_recording_2">å½•éŸ³ 2: (è½»å¾®çš„å‘¼å™œå£°)</p><p class="text-caption">03:15 AM Â· 12ç§’</p></div></div>
                    </div>
                </div>
                <button onclick="navigate('home', document.querySelector('.nav-item'))" class="btn btn-primary w-full mt-auto" data-lang="summary_complete_button">å®Œæˆ</button>
            </div>
            
            <!-- Settings Page -->
            <div id="settings" class="screen h-full p-6 text-white flex-col">
                <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8" data-lang="settings_title">è®¾ç½®</h1></div>
                <div class="space-y-6">
                    <div class="ios-list"><div class="ios-list-item"><div class="ios-list-icon bg-yellow-500"><i data-lucide="gem"></i></div><div><p data-lang="settings_plus_member">O.O Plus ä¼šå‘˜</p><p class="text-caption" data-lang="settings_plus_status">å·²æ¿€æ´»</p></div></div></div>
                    <div class="ios-list"><div class="ios-list-item"><div class="ios-list-icon bg-purple-500"><i data-lucide="user-cog"></i></div><p data-lang="settings_account">è´¦æˆ·</p><i data-lucide="chevron-right" class="ml-auto text-[var(--color-text-weak)]"></i></div><div class="ios-list-item"><div class="ios-list-icon bg-green-500"><i data-lucide="heart-pulse"></i></div><p data-lang="settings_health">è¿æ¥åˆ° "å¥åº·"</p><i data-lucide="chevron-right" class="ml-auto text-[var(--color-text-weak)]"></i></div></div>
                    <div class="ios-list"><div class="ios-list-item"><div class="ios-list-icon bg-blue-500"><i data-lucide="app-window"></i></div><p data-lang="settings_widgets">å°ç»„ä»¶ä¸çµåŠ¨å²›</p><i data-lucide="chevron-right" class="ml-auto text-[var(--color-text-weak)]"></i></div></div>
                </div>
            </div>

            <!-- Other Pages (Stubs) -->
            <div id="notifications" class="screen h-full p-6 text-white flex-col">
                 <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8" data-lang="notifications_title">é€šçŸ¥</h1></div>
                 <p class="text-center text-[var(--color-text-secondary)]" data-lang="notifications_empty">è¿™é‡Œè¿˜æ²¡æœ‰é€šçŸ¥</p>
            </div>
            <div id="pet-customization" class="screen h-full p-6 text-white flex-col">
                <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8" data-lang="pet_custom_title">AI å® ç‰©å®šåˆ¶</h1></div>
                <p class="text-center text-caption mb-4" data-lang="pet_custom_desc">é€šè¿‡ AI ç”Ÿæˆä½ ç‹¬ä¸€æ— äºŒçš„ç¡çœ ä¼™ä¼´</p>
                <div class="card"><p class="text-body font-bold" data-lang="pet_custom_form">å½¢æ€</p><p class="text-caption" data-lang="pet_custom_form_current">å½“å‰ï¼šç†ŠçŒ«</p></div>
                <div class="card mt-4"><p class="text-body font-bold" data-lang="pet_custom_voice">è¯­éŸ³</p><p class="text-caption" data-lang="pet_custom_voice_current">å½“å‰ï¼šæ¸©æŸ”å¥³å£°</p></div>
            </div>
            <div id="store" class="screen h-full p-6 text-white flex-col">
                <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8" data-lang="store_title">å•†åº—</h1></div>
                <div class="card bg-cover bg-center" style="background-image: url('https://placehold.co/600x300/6C63FF/FFFFFF?text=é™å®šæ´»åŠ¨')"><p class="text-title font-bold" data-lang="store_event_title">ä¸‡åœ£èŠ‚é™å®šè£…æ‰®</p></div>
            </div>
            <div id="routine-planner" class="screen h-full p-6 text-white flex-col">
                <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8" data-lang="routine_title">ä½œæ¯ç®¡ç†</h1></div>
                <div class="ios-list"><div class="ios-list-item"><p data-lang="routine_bedtime">å°±å¯æé†’</p><span class="ml-auto text-caption">23:00</span><i data-lucide="chevron-right" class="ml-2 text-[var(--color-text-weak)]"></i></div></div>
            </div>
            <div id="badge-gallery" class="screen h-full p-6 text-white flex-col overflow-y-auto">
                <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8" data-lang="badge_title">å¾½ç« æˆå°±</h1></div>
                <div class="grid grid-cols-3 gap-6">
                    <div class="text-center"><div class="bg-yellow-400/20 rounded-full w-24 h-24 mx-auto flex items-center justify-center border-2 border-yellow-400 shadow-lg" style="box-shadow: 0 0 15px rgba(250, 204, 21, 0.5);"><i data-lucide="sunrise" class="w-12 h-12 text-yellow-300"></i></div><p class="font-bold mt-2 text-body" data-lang="badge_early_bird_name">æ—©é¸Ÿ</p><p class="text-caption" data-lang="badge_early_bird_desc">è¿ç»­3å¤©æ—©èµ·</p></div>
                    <div class="text-center"><div class="bg-emerald-400/20 rounded-full w-24 h-24 mx-auto flex items-center justify-center border-2 border-emerald-400 shadow-lg" style="box-shadow: 0 0 15px rgba(52, 211, 153, 0.5);"><i data-lucide="calendar-check" class="w-12 h-12 text-emerald-300"></i></div><p class="font-bold mt-2 text-body" data-lang="badge_7_day_name">7æ—¥è¿è´¯</p><p class="text-caption" data-lang="badge_7_day_desc">è¿ç»­è®°å½•7å¤©</p></div>
                    <div class="text-center opacity-40"><div class="bg-gray-700 rounded-full w-24 h-24 mx-auto flex items-center justify-center border-2 border-gray-600"><i data-lucide="moon-star" class="w-12 h-12 text-gray-500"></i></div><p class="font-bold mt-2 text-body" data-lang="badge_monthly_name">æœˆåº¦å…¨å‹¤</p><p class="text-caption">???</p></div>
                    <div class="text-center opacity-40"><div class="bg-gray-700 rounded-full w-24 h-24 mx-auto flex items-center justify-center border-2 border-gray-600"><i data-lucide="message-square" class="w-12 h-12 text-gray-500"></i></div><p class="font-bold mt-2 text-body" data-lang="badge_talker_name">æ¢¦è¯æ”¶è—å®¶</p><p class="text-caption">???</p></div>
                    <div class="text-center opacity-40"><div class="bg-gray-700 rounded-full w-24 h-24 mx-auto flex items-center justify-center border-2 border-gray-600"><i data-lucide="users" class="w-12 h-12 text-gray-500"></i></div><p class="font-bold mt-2 text-body" data-lang="badge_social_name">ç¤¾äº¤è¾¾äºº</p><p class="text-caption">???</p></div>
                </div>
            </div>

        </main>

        <nav class="w-full bg-black/30 backdrop-blur-md border-t border-white/10 flex justify-around p-2">
            <button class="nav-item active flex-1 flex flex-col items-center justify-center p-1" onclick="navigate('home', this)"><i data-lucide="tent" class="nav-icon w-7 h-7 text-[var(--color-text-weak)]"></i><span class="nav-label text-xs text-[var(--color-text-weak)] mt-1" data-lang="tab_home">ä¸»é¡µ</span></button>
            <button class="nav-item flex-1 flex flex-col items-center justify-center p-1" onclick="navigate('sleep', this)"><i data-lucide="bed-double" class="nav-icon w-7 h-7 text-[var(--color-text-weak)]"></i><span class="nav-label text-xs text-[var(--color-text-weak)] mt-1" data-lang="tab_sleep">ç¡çœ </span></button>
            <button class="nav-item flex-1 flex flex-col items-center justify-center p-1" onclick="navigate('competing', this)"><i data-lucide="trophy" class="nav-icon w-7 h-7 text-[var(--color-text-weak)]"></i><span class="nav-label text-xs text-[var(--color-text-weak)] mt-1" data-lang="tab_competing">ç«èµ›</span></button>
        </nav>

        <!-- Modals -->
        <div id="sleep-modal" class="modal-sheet rounded-t-3xl p-6 text-white flex-col">
            <div class="w-10 h-1.5 bg-gray-600 rounded-full mx-auto mb-6"></div><h2 id="modal-title" class="text-h2 text-center mb-6" data-lang="modal_sleep_title">å‡†å¤‡å…¥ç¡</h2>
            <div class="text-center my-auto"><p id="modal-countdown" class="text-h1" style="font-size: 80px;"></p><p id="modal-text" class="text-caption" data-lang="modal_sleep_desc">å°†ä¸ºä½ æ’­æ”¾ç™½å™ªéŸ³ã€Œé›¨å¤œã€</p></div>
            <button onclick="startSleepNow()" class="btn btn-primary w-full mt-auto" data-lang="modal_start_now">ç«‹å³å¼€å§‹</button><button onclick="hideSleepModal()" class="btn btn-secondary w-full mt-2" data-lang="modal_cancel">å–æ¶ˆ</button>
        </div>
        <div id="background-modal" class="modal-sheet rounded-t-3xl p-6 text-white flex-col">
             <div class="w-10 h-1.5 bg-gray-600 rounded-full mx-auto mb-6"></div><h2 class="text-h2 text-center mb-6" data-lang="modal_scene_title">æ›´æ¢åœºæ™¯</h2>
             <div id="scene-options-container" class="grid grid-cols-2 gap-4 overflow-y-auto"></div>
        </div>
        <div id="props-modal" class="modal-sheet rounded-t-3xl p-6 text-white flex-col">
             <div class="w-10 h-1.5 bg-gray-600 rounded-full mx-auto mb-6"></div><h2 class="text-h2 text-center mb-6" data-lang="modal_props_title">é“å…·ä¸è£…æ‰®</h2>
             <div id="prop-options-container" class="grid grid-cols-3 gap-4 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        let sleepInterval, modalCountdownInterval, heartRateInterval;
        let navigationStack = ['onboarding-flow']; 
        let currentPermissionStep = 'mic';
        let currentLang = 'zh';

        const translations = {
            en: {
                onboarding_welcome_slogan: "Your Sleep, Its Growth Story",
                onboarding_start_journey: "Start Journey",
                onboarding_mic_title: "Microphone Access",
                onboarding_mic_desc: "O.O needs the microphone to listen for sleep talk and snoring to create fun sleep reports for you.",
                onboarding_notify_title: "Notification Access",
                onboarding_notify_desc: "Allow us to send bedtime reminders, so O.O can join you for sleep on time.",
                onboarding_auth_button: "Authorize",
                onboarding_pet_title: "Your Sleep Companion",
                onboarding_pet_desc: "Give your panda pal a name!",
                onboarding_pet_button: "That's the name!",
                onboarding_goals_title: "Set Your Goals",
                onboarding_goals_q1: "What's your main sleep challenge?",
                onboarding_goals_o1: "Trouble Falling Asleep",
                onboarding_goals_o2: "Light Sleeper",
                onboarding_goals_o3: "Waking Up Often",
                onboarding_goals_o4: "Dreamful Sleep",
                onboarding_goals_q2: "What's your target bedtime?",
                onboarding_goals_button: "Goals Set",
                onboarding_intro_greeting: "Hi! I'm {petName}",
                onboarding_intro_desc: "Through high-quality sleep,<br>you'll earn stars to help me grow!",
                onboarding_intro_button: "Get Started",
                home_pet_status: "{petName} is resting",
                home_halloween_title: "Halloween Limited Outfit",
                home_halloween_desc: "Check out O.O's new clothes!",
                home_start_sleep: "Start Sleep",
                tab_home: "Home",
                tab_sleep: "Sleep",
                tab_competing: "Compete",
                sleep_title: "Sleep Center",
                sleep_calendar_title: "Sleep Calendar",
                sleep_legend_excellent: "Excellent",
                sleep_legend_good: "Good",
                sleep_legend_fair: "Fair",
                sleep_noise_title: "White Noise",
                noise_none: "None",
                noise_rain: "Rainy Night",
                noise_wind: "Wind",
                noise_waves: "Waves",
                noise_fire: "Campfire",
                noise_train: "Train",
                sleep_routine_title: "Routine Planner",
                sleep_routine_desc: "O.O's special animated reminders",
                compete_title: "Sleep Compete",
                compete_friends: "Friends",
                compete_global: "Global",
                compete_you: "You",
                compete_score_unit: "pts",
                compete_team_title: "Team Up for Sleep",
                compete_team_desc: "Invite friends to complete goals together and win extra rewards!",
                compete_team_button: "Create Team",
                badge_title: "Badge Achievements",
                badge_early_bird_name: "Early Bird",
                badge_early_bird_desc: "Woke up early 3 days in a row",
                badge_7_day_name: "7-Day Streak",
                badge_7_day_desc: "Recorded for 7 consecutive days",
                badge_monthly_name: "Perfect Month",
                badge_talker_name: "Dream Talk Collector",
                badge_social_name: "Social Butterfly",
                modal_sleep_title: "Preparing for sleep",
                modal_sleep_desc: "Now playing white noise 'Rainy Night'",
                modal_start_now: "Start Now",
                modal_cancel: "Cancel",
                modal_scene_title: "Change Scene",
                modal_props_title: "Props & Outfits",
                scene_night_sky: "Silent Night Sky",
                scene_dusk: "Twilight Forest",
                scene_twilight: "Deep Dusk",
                scene_aurora: "Aurora Realm",
                prop_none: "None",
                prop_hat: "Party Hat",
                prop_glasses: "Sunglasses",
                insleep_your_hr: "Your Heart Rate",
                insleep_pet_hr: "O.O's Heart Rate",
                insleep_recording: "Recording sleep...",
                insleep_end_button: "Hold to End",
                summary_greeting: "Good Morning!",
                summary_subtitle: "O.O spent another peaceful night with you.",
                summary_reward_title: "Rewards for this sleep",
                summary_score_label: "Sleep Score",
                summary_score_unit: "pts",
                summary_duration_label: "Time Asleep",
                summary_deep_sleep_label: "Deep Sleep",
                summary_sleeptalk_title: "Sleep Talk & Snoring",
                summary_sleeptalk_subtitle: "O.O heard this...",
                summary_sleeptalk_feedback: `"You seemed to be saying 'one more donut' last night... It made me hungry! ğŸ˜´"`,
                summary_recording_1: `Recording 1: "...one more..."`,
                summary_recording_2: `Recording 2: (Light snoring)`,
                summary_complete_button: "Done",
                settings_title: "Settings",
                settings_plus_member: "O.O Plus Member",
                settings_plus_status: "Active",
                settings_account: "Account",
                settings_health: "Connect to Health",
                settings_widgets: "Widgets & Dynamic Island",
                notifications_title: "Notifications",
                notifications_empty: "No notifications yet",
                pet_custom_title: "AI Pet Customization",
                pet_custom_desc: "Generate your unique sleep companion with AI",
                pet_custom_form: "Appearance",
                pet_custom_form_current: "Current: Panda",
                pet_custom_voice: "Voice",
                pet_custom_voice_current: "Current: Gentle Female",
                store_title: "Shop",
                store_event_title: "Halloween Limited Outfit",
                routine_title: "Routine Planner",
                routine_bedtime: "Bedtime Reminder",
            },
            zh: {
                onboarding_welcome_slogan: "Your Sleep, Its Growth Story",
                onboarding_start_journey: "å¼€å¯æ—…ç¨‹",
                onboarding_mic_title: "éº¦å…‹é£æƒé™",
                onboarding_mic_desc: "O.O éœ€è¦éº¦å…‹é£æ¥å€¾å¬ä½ çš„æ¢¦è¯ä¸å‘¼å™œï¼Œä¸ºä½ ç”Ÿæˆæœ‰è¶£çš„ç¡çœ æŠ¥å‘Šã€‚",
                onboarding_notify_title: "é€šçŸ¥æƒé™",
                onboarding_notify_desc: "å…è®¸æˆ‘ä»¬å‘é€ç¡å‰æé†’ï¼Œè®© O.O å‡†æ—¶é™ªä½ å…¥ç¡ã€‚",
                onboarding_auth_button: "æˆæƒ",
                onboarding_pet_title: "ä½ çš„ç¡çœ ä¼™ä¼´",
                onboarding_pet_desc: "ä¸ºä½ çš„ç†ŠçŒ«ä¼™ä¼´å–ä¸ªåå­—å§",
                onboarding_pet_button: "å°±å«è¿™ä¸ªï¼",
                onboarding_goals_title: "è®¾å®šä½ çš„ç›®æ ‡",
                onboarding_goals_q1: "ä½ ä¸»è¦çš„ç¡çœ å›°æ‰°æ˜¯ï¼Ÿ",
                onboarding_goals_o1: "å…¥ç¡å›°éš¾",
                onboarding_goals_o2: "ç¡çœ æµ…",
                onboarding_goals_o3: "å®¹æ˜“é†’",
                onboarding_goals_o4: "å¤šæ¢¦",
                onboarding_goals_q2: "ä½ çš„ç›®æ ‡å…¥ç¡æ—¶é—´æ˜¯ï¼Ÿ",
                onboarding_goals_button: "å®Œæˆè®¾å®š",
                onboarding_intro_greeting: "ä½ å¥½ï¼æˆ‘æ˜¯{petName}",
                onboarding_intro_desc: "é€šè¿‡é«˜è´¨é‡çš„ç¡çœ ï¼Œ<br>ä½ å°†è·å¾—æ˜Ÿæ˜Ÿï¼Œå¸®åŠ©æˆ‘æˆé•¿ï¼",
                onboarding_intro_button: "å¼€å§‹ä½¿ç”¨",
                home_pet_status: "{petName} æ­£åœ¨ä¼‘æ¯",
                home_halloween_title: "ä¸‡åœ£èŠ‚é™å®šè£…æ‰®",
                home_halloween_desc: "ç‚¹å‡»æŸ¥çœ‹ O.O çš„æ–°è¡£æœï¼",
                home_start_sleep: "å¼€å§‹ç¡çœ ",
                tab_home: "ä¸»é¡µ",
                tab_sleep: "ç¡çœ ",
                tab_competing: "ç«èµ›",
                sleep_title: "ç¡çœ ä¸­å¿ƒ",
                sleep_calendar_title: "ç¡çœ æ—¥å†",
                sleep_legend_excellent: "ä¼˜ç§€",
                sleep_legend_good: "è‰¯å¥½",
                sleep_legend_fair: "ä¸€èˆ¬",
                sleep_noise_title: "ç™½å™ªéŸ³",
                noise_none: "æ— ",
                noise_rain: "é›¨å¤œ",
                noise_wind: "é£å£°",
                noise_waves: "æµ·æµª",
                noise_fire: "ç¯ç«",
                noise_train: "åˆ—è½¦",
                sleep_routine_title: "ä½œæ¯ç®¡ç†",
                sleep_routine_desc: "O.O çš„ä¸“å±åŠ¨ç”»æé†’",
                compete_title: "ç¡çœ ç«èµ›",
                compete_friends: "å¥½å‹",
                compete_global: "å…¨çƒ",
                compete_you: "ä½ ",
                compete_score_unit: "åˆ†",
                compete_team_title: "å¥½å‹ç»„é˜Ÿç¡çœ ",
                compete_team_desc: "é‚€è¯·å¥½å‹ä¸€èµ·å®Œæˆç›®æ ‡ï¼Œèµ¢å–é¢å¤–å¥–åŠ±ï¼",
                compete_team_button: "åˆ›å»ºé˜Ÿä¼",
                badge_title: "å¾½ç« æˆå°±",
                badge_early_bird_name: "æ—©é¸Ÿ",
                badge_early_bird_desc: "è¿ç»­3å¤©æ—©èµ·",
                badge_7_day_name: "7æ—¥è¿è´¯",
                badge_7_day_desc: "è¿ç»­è®°å½•7å¤©",
                badge_monthly_name: "æœˆåº¦å…¨å‹¤",
                badge_talker_name: "æ¢¦è¯æ”¶è—å®¶",
                badge_social_name: "ç¤¾äº¤è¾¾äºº",
                modal_sleep_title: "å‡†å¤‡å…¥ç¡",
                modal_sleep_desc: "å°†ä¸ºä½ æ’­æ”¾ç™½å™ªéŸ³ã€Œé›¨å¤œã€",
                modal_start_now: "ç«‹å³å¼€å§‹",
                modal_cancel: "å–æ¶ˆ",
                modal_scene_title: "æ›´æ¢åœºæ™¯",
                modal_props_title: "é“å…·ä¸è£…æ‰®",
                scene_night_sky: "é™è°§å¤œç©º",
                scene_dusk: "è–„æš®æ£®æ—",
                scene_twilight: "æ·±é‚ƒæš®å…‰",
                scene_aurora: "æå…‰ä¹‹å¢ƒ",
                prop_none: "æ— ",
                prop_hat: "æ´¾å¯¹å¸½",
                prop_glasses: "å¤ªé˜³é•œ",
                insleep_your_hr: "ä½ çš„å¿ƒç‡",
                insleep_pet_hr: "O.Oçš„å¿ƒç‡",
                insleep_recording: "æ­£åœ¨è®°å½•ç¡çœ ...",
                insleep_end_button: "é•¿æŒ‰ç»“æŸ",
                summary_greeting: "æ—©ä¸Šå¥½ï¼",
                summary_subtitle: "O.O é™ªä½ åº¦è¿‡äº†åˆä¸€ä¸ªå®‰ç¨³çš„å¤œæ™šã€‚",
                summary_reward_title: "æœ¬æ¬¡ç¡çœ è·å¾—",
                summary_score_label: "ç¡çœ åˆ†æ•°",
                summary_score_unit: "åˆ†",
                summary_duration_label: "ç¡çœ æ—¶é•¿",
                summary_deep_sleep_label: "æ·±ç¡å æ¯”",
                summary_sleeptalk_title: "æ¢¦è¯ä¸å‘¼å™œ",
                summary_sleeptalk_subtitle: "O.O å¬åˆ°äº†è¿™äº›...",
                summary_sleeptalk_feedback: `"ä¸»äººï¼Œä½ æ˜¨æ™šå¥½åƒåœ¨è¯´'å†æ¥ä¸€ä¸ªç”œç”œåœˆ'...å¬å¾—æˆ‘éƒ½é¥¿äº†ï¼ğŸ˜´"`,
                summary_recording_1: `å½•éŸ³ 1: "...å†æ¥ä¸€ä¸ª..."`,
                summary_recording_2: `å½•éŸ³ 2: (è½»å¾®çš„å‘¼å™œå£°)`,
                summary_complete_button: "å®Œæˆ",
                settings_title: "è®¾ç½®",
                settings_plus_member: "O.O Plus ä¼šå‘˜",
                settings_plus_status: "å·²æ¿€æ´»",
                settings_account: "è´¦æˆ·",
                settings_health: "è¿æ¥åˆ° \"å¥åº·\"",
                settings_widgets: "å°ç»„ä»¶ä¸çµåŠ¨å²›",
                notifications_title: "é€šçŸ¥",
                notifications_empty: "è¿™é‡Œè¿˜æ²¡æœ‰é€šçŸ¥",
                pet_custom_title: "AI å® ç‰©å®šåˆ¶",
                pet_custom_desc: "é€šè¿‡ AI ç”Ÿæˆä½ ç‹¬ä¸€æ— äºŒçš„ç¡çœ ä¼™ä¼´",
                pet_custom_form: "å½¢æ€",
                pet_custom_form_current: "å½“å‰ï¼šç†ŠçŒ«",
                pet_custom_voice: "è¯­éŸ³",
                pet_custom_voice_current: "å½“å‰ï¼šæ¸©æŸ”å¥³å£°",
                store_title: "å•†åº—",
                store_event_title: "ä¸‡åœ£èŠ‚é™å®šè£…æ‰®",
                routine_title: "ä½œæ¯ç®¡ç†",
                routine_bedtime: "å°±å¯æé†’",
            }
        };

        function setLanguage(lang) {
            currentLang = lang;
            const petName = document.getElementById('pet-name-input').value || (lang === 'en' ? 'An An' : 'å®‰å®‰');
            
            document.querySelectorAll('[data-lang]').forEach(element => {
                const key = element.getAttribute('data-lang');
                let text = translations[lang][key] || translations['zh'][key];

                if (text && typeof text === 'string' && text.includes('{petName}')) {
                    text = text.replace('{petName}', petName);
                }

                if(text) {
                   element.innerHTML = text;
                }
            });

            if (lang === 'en' && document.getElementById('pet-name-input').value === 'å®‰å®‰') {
                 document.getElementById('pet-name-input').value = 'An An';
            } else if (lang === 'zh' && document.getElementById('pet-name-input').value === 'An An') {
                 document.getElementById('pet-name-input').value = 'å®‰å®‰';
            }
            
            populateScenes();
            populateProps();

            nextOnboardingStep('onboarding-welcome');
        }
        
        function nextOnboardingStep(nextStepId) {
            if (nextStepId === 'onboarding-intro') {
                const petName = document.getElementById('pet-name-input').value || (currentLang === 'en' ? 'An An' : 'å®‰å®‰');
                const greetingEl = document.getElementById('intro-title');
                let text = translations[currentLang]['onboarding_intro_greeting'].replace('{petName}', petName);
                greetingEl.textContent = text;
                
                const homePetNameEl = document.getElementById('home-pet-name');
                let homeText = translations[currentLang]['home_pet_status'].replace('{petName}', petName);
                homePetNameEl.textContent = homeText;
            }
            document.querySelectorAll('.onboarding-screen').forEach(s => s.classList.remove('active'));
            document.getElementById(nextStepId).classList.add('active');
        }

        function grantPermissions() {
            if (currentPermissionStep === 'mic') {
                document.getElementById('permission-mic').classList.add('hidden');
                document.getElementById('permission-notify').classList.remove('hidden');
                currentPermissionStep = 'notify';
            } else {
                nextOnboardingStep('onboarding-pet');
            }
        }
        
        function toggleGoal(element) {
            element.classList.toggle('selected');
        }

        function finishOnboarding() {
            document.getElementById('onboarding-flow').classList.remove('active');
            navigate('home', document.querySelector('.nav-item'));
        }

        const scenes = [
            { id: 'night_sky', name_key: 'scene_night_sky', style: 'var(--color-bg-primary)', noiseId: 'none' },
            { id: 'dusk', name_key: 'scene_dusk', style: 'linear-gradient(to top, #4338ca, #312e81)', noiseId: 'rain' },
            { id: 'twilight', name_key: 'scene_twilight', style: 'linear-gradient(to top, #1e3a8a, #4c1d95)', noiseId: 'wind' },
            { id: 'aurora', name_key: 'scene_aurora', style: 'linear-gradient(to top, #0c4a6e, #7e22ce)', noiseId: 'waves' }
        ];

        const props = [
            { id: 'none', name_key: 'prop_none', icon: 'slash' },
            { id: 'hat', name_key: 'prop_hat', imageUrl: 'https://placehold.co/80x80/ffffff/000000/png?text=%F0%9F%8E%89', style: 'position: absolute; top: 15%; left: 50%; width: 30%; transform: translateX(-50%) rotate(-15deg);' },
            { id: 'glasses', name_key: 'prop_glasses', imageUrl: 'https://placehold.co/120x40/ffffff/000000/png?text=%F0%9F%98%8E', style: 'position: absolute; top: 40%; left: 50%; width: 45%; transform: translateX(-50%);' }
        ];

        function populateScenes() {
            const container = document.getElementById('scene-options-container');
            if (!container) return;
            container.innerHTML = '';
            scenes.forEach(scene => {
                const sceneEl = document.createElement('div');
                sceneEl.className = 'text-center cursor-pointer';
                sceneEl.onclick = () => selectScene(scene.id);
                sceneEl.innerHTML = `<div class="w-full h-24 rounded-lg mb-2" style="background: ${scene.style};"></div><p class="text-body font-bold">${translations[currentLang][scene.name_key]}</p>`;
                container.appendChild(sceneEl);
            });
        }
        
        function populateProps() {
            const container = document.getElementById('prop-options-container');
            if (!container) return;
            container.innerHTML = '';
            props.forEach(prop => {
                const propEl = document.createElement('div');
                propEl.className = 'text-center cursor-pointer card !p-2';
                propEl.onclick = () => selectProp(prop.id);
                let iconHtml = prop.imageUrl ? `<img src="${prop.imageUrl}" class="w-16 h-16 mx-auto object-contain">` : `<div class="w-16 h-16 mx-auto flex items-center justify-center"><i data-lucide="${prop.icon}" class="w-8 h-8 text-gray-400"></i></div>`;
                propEl.innerHTML = `${iconHtml}<p class="text-caption mt-1">${translations[currentLang][prop.name_key]}</p>`;
                container.appendChild(propEl);
            });
            lucide.createIcons();
        }

        function selectScene(sceneId) {
            const scene = scenes.find(s => s.id === sceneId);
            if (!scene) return;
            document.getElementById('pet-display-area').style.background = scene.style;
            const noiseOption = document.querySelector(`.noise-option[data-noise-id="${scene.noiseId}"]`);
            if (noiseOption) {
                 document.querySelectorAll('.noise-option').forEach(option => {
                    option.classList.remove('border-[var(--color-brand-purple)]');
                    option.classList.add('border-transparent');
                });
                noiseOption.classList.add('border-[var(--color-brand-purple)]');
                noiseOption.classList.remove('border-transparent');
            }
            hideBackgroundModal();
        }

        function selectProp(propId) {
            const prop = props.find(p => p.id === propId);
            if (!prop) return;
            const container = document.getElementById('prop-overlay-container');
            container.innerHTML = (prop.id !== 'none') ? `<img src="${prop.imageUrl}" style="${prop.style}">` : '';
            hidePropsModal();
        }

        function showBackgroundModal() { document.getElementById('modal-overlay').classList.add('show'); document.getElementById('background-modal').classList.add('show'); }
        function hideBackgroundModal() { document.getElementById('modal-overlay').classList.remove('show'); document.getElementById('background-modal').classList.remove('show'); }
        function showPropsModal() { document.getElementById('modal-overlay').classList.add('show'); document.getElementById('props-modal').classList.add('show'); }
        function hidePropsModal() { document.getElementById('modal-overlay').classList.remove('show'); document.getElementById('props-modal').classList.remove('show'); }

        function navigate(screenId, navElement) {
            const currentScreen = navigationStack[navigationStack.length - 1];
            if (screenId === currentScreen && navElement) return; 

            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            if (navElement) {
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                navElement.classList.add('active');
                navigationStack.length = 1; 
                navigationStack[0] = screenId;
            } else if (navigationStack[navigationStack.length - 1] !== screenId) {
                navigationStack.push(screenId);
            }
        }

        function goBack() {
            if (navigationStack.length <= 1) return;
            navigationStack.pop();
            const previousScreen = navigationStack[navigationStack.length - 1];
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(previousScreen).classList.add('active');
        }
        
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            if (!calendarGrid) return;
            calendarGrid.innerHTML = '';
            const daysOfWeek = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            daysOfWeek.forEach(day => { calendarGrid.insertAdjacentHTML('beforeend', `<div class="text-center text-caption font-bold">${day}</div>`); });
            const firstDayOffset = 3; 
            for (let i = 0; i < firstDayOffset; i++) { calendarGrid.insertAdjacentHTML('beforeend', '<div></div>'); }
            const today = 22;
            const daysInMonth = 31;
            for (let day = 1; day <= daysInMonth; day++) {
                let dayClass = 'relative h-8 w-8 flex items-center justify-center mx-auto rounded-full';
                if (day < today) {
                    const sleepScore = 50 + Math.random() * 50;
                    if (sleepScore >= 90) dayClass += ' border-2 border-[var(--color-brand-purple)]';
                    else if (sleepScore >= 75) dayClass += ' border-2 border-[var(--color-soft-blue)]';
                    else dayClass += ' border-2 border-gray-500';
                }
                if (day === today) dayClass += ' bg-[var(--color-brand-purple)] text-white font-bold';
                calendarGrid.insertAdjacentHTML('beforeend', `<div class="${dayClass}">${day}</div>`);
            }
        }
        
        function showSleepModal() { document.getElementById('modal-overlay').classList.add('show'); document.getElementById('sleep-modal').classList.add('show'); let countdown = 5; document.getElementById('modal-countdown').textContent = countdown; modalCountdownInterval = setInterval(() => { countdown--; document.getElementById('modal-countdown').textContent = countdown; if (countdown === 0) startSleepNow(); }, 1000); }
        function hideSleepModal() { document.getElementById('modal-overlay').classList.remove('show'); document.getElementById('sleep-modal').classList.remove('show'); }
        function hideAllModals() { hideSleepModal(); hideBackgroundModal(); hidePropsModal(); }
        
        function startSleepNow() {
            clearInterval(modalCountdownInterval);
            hideSleepModal();
            navigate('in-sleep');
            let secondsSlept = 0;
            const timerDisplay = document.getElementById('sleep-timer');
            sleepInterval = setInterval(() => {
                secondsSlept++;
                const h = String(Math.floor(secondsSlept / 3600)).padStart(2, '0');
                const m = String(Math.floor((secondsSlept % 3600) / 60)).padStart(2, '0');
                const s = String(secondsSlept % 60).padStart(2, '0');
                timerDisplay.textContent = `${h}:${m}:${s}`;
                if (secondsSlept > 5) { endSleep(); }
            }, 1000);
            heartRateInterval = setInterval(() => {
                document.getElementById('user-heart-rate').textContent = Math.floor(60 + Math.random() * 10);
                document.getElementById('pet-heart-rate').textContent = Math.floor(65 + Math.random() * 10);
            }, 2000);
        }

        function endSleep() {
            clearInterval(sleepInterval);
            clearInterval(heartRateInterval);
            navigate('morning-summary');
        }

        document.addEventListener('DOMContentLoaded', () => { 
            document.getElementById('onboarding-flow').classList.add('active'); // Start with onboarding flow
            generateCalendar();
            populateScenes();
            populateProps();
            
            const noiseContainer = document.getElementById('noise-options-container');
            if(noiseContainer) {
                noiseContainer.addEventListener('click', (e) => {
                    const selectedCard = e.target.closest('.noise-option');
                    if (!selectedCard) return;
                    document.querySelectorAll('.noise-option').forEach(option => {
                        option.classList.remove('border-[var(--color-brand-purple)]');
                        option.classList.add('border-transparent');
                    });
                    selectedCard.classList.add('border-[var(--color-brand-purple)]');
                    selectedCard.classList.remove('border-transparent');
                });
            }
            
            const tabsContainer = document.getElementById('leaderboard-tabs');
            if(tabsContainer) {
                tabsContainer.addEventListener('click', (e) => {
                    const selectedTab = e.target.closest('.tab-btn');
                    if(!selectedTab) return;
                    tabsContainer.querySelectorAll('.tab-btn').forEach(tab => tab.classList.remove('active'));
                    selectedTab.classList.add('active');
                });
            }
        });
    </script>
</body>
</html>

