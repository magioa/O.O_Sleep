<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O.O Sleep - UI åŸå‹ v9 (é“å…·è£…æ‰®)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Design Tokens */
        :root {
            --color-bg-primary: #23255A; --color-brand-purple: #6C63FF;
            --color-soft-blue: #78A6FF; --color-cloud-blue: #9EC6FF;
            --color-starlight-blue: #B8D1FF; --color-success: #4CD964;
            --color-text-primary: #EDEFF7; --color-text-secondary: #B9BED5;
            --color-text-weak: #8B90A6; --color-text-inverted: #0E0F2D;
            --color-card-bg: #1a1c4a; --color-card-border: #3B3F7A;
            --brand-grad: linear-gradient(180deg, #9EC6FF 0%, #6C63FF 100%);
            --radius-card: 20px; --radius-button: 14px;
            --shadow-card: 0 8px 24px 0 rgba(20,24,74,0.18);
        }
        body { font-family: 'SF Pro', 'PingFang SC', 'Noto Sans SC', sans-serif; background-color: var(--color-bg-primary); color: var(--color-text-primary); }
        .phone-mockup { max-width: 420px; height: 880px; }
        .screen { display: none; animation: fadeIn 0.3s; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* Typography */
        .text-h1 { font-size: 32px; line-height: 1.2; font-weight: 700; }
        .text-h2 { font-size: 24px; line-height: 1.25; font-weight: 700; }
        .text-title { font-size: 20px; line-height: 1.3; font-weight: 700; }
        .text-body { font-size: 16px; line-height: 1.5; }
        .text-caption { font-size: 13px; line-height: 1.4; color: var(--color-text-secondary); }
        /* Components */
        .card { background-color: var(--color-card-bg); border-radius: var(--radius-card); padding: 16px; box-shadow: var(--shadow-card); position: relative; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: rgba(255,255,255,0.15); border-radius: var(--radius-card) var(--radius-card) 0 0; }
        .btn { height: 56px; padding: 0 20px; border-radius: var(--radius-button); font-weight: 700; display: inline-flex; align-items: center; justify-content: center; transition: all 0.1s ease-out; }
        .btn:active { transform: scale(0.98); filter: brightness(0.94); }
        .btn-primary { background: var(--brand-grad); color: var(--color-text-inverted); }
        .btn-secondary { background-color: #31336F; border: 1px solid var(--color-card-border); color: var(--color-text-primary); }
        .ios-list { background-color: var(--color-card-bg); border-radius: 12px; }
        .ios-list-item { display: flex; align-items: center; padding: 12px 16px; border-bottom: 1px solid rgba(139, 144, 166, 0.2); }
        .ios-list-item:last-child { border-bottom: none; }
        .ios-list-icon { width: 30px; height: 30px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 16px; }
        .nav-item.active .nav-icon { transform: scale(1.1); color: var(--color-brand-purple); }
        .nav-item.active .nav-label { color: var(--color-brand-purple); }
        .modal-sheet { position: absolute; bottom: 0; left: 0; right: 0; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); z-index: 50; background: #1E2235; backdrop-filter: blur(20px); }
        .modal-sheet.show { transform: translateY(0); }
        .modal-overlay { position: absolute; inset: 0; background-color: rgba(0,0,0,0.4); opacity: 0; transition: opacity 0.4s ease; pointer-events: none; z-index: 40; }
        .modal-overlay.show { opacity: 1; pointer-events: auto; }
        .breathing-pet { animation: breathing 6s ease-in-out infinite; }
        @keyframes breathing { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
        .tab-btn.active { background-color: var(--color-soft-blue); color: var(--color-text-inverted); }
    </style>
</head>
<body class="bg-gray-800 flex items-center justify-center min-h-screen p-4">
    <div class="phone-mockup w-full rounded-[40px] border-[10px] border-gray-700 shadow-2xl overflow-hidden relative flex flex-col bg-[var(--color-bg-primary)]">
        
        <div id="modal-overlay" class="modal-overlay" onclick="hideAllModals()"></div>

        <main class="flex-grow overflow-y-auto">
            <!-- Onboarding -->
            <div id="onboarding" class="screen active h-full p-8 text-white flex-col justify-between text-center">
                <div></div>
                <div><img src="https://placehold.co/192x192/23255A/EDEFF7?text=O.O&font=lora" alt="å¯çˆ±çš„AIç¡çœ å® ç‰©" class="w-48 mx-auto breathing-pet rounded-full"><h1 class="text-h1 mt-8">ä½ å¥½ï¼Œæˆ‘æ˜¯ O.O</h1><p class="text-body mt-4 text-[var(--color-text-secondary)]">O.O æƒ³å®ˆæŠ¤ä½ çš„æ¯ä¸ªå¤œæ™šï¼Œ<br>è®©æˆ‘ä»¬ä¸€èµ·å¼€å¯æ¢¦å¢ƒä¹‹æ—…å§ã€‚</p></div>
                <button onclick="navigate('home', document.querySelector('.nav-item'))" class="btn btn-primary w-full">ç»§ç»­</button>
            </div>

            <!-- B. Home (å® ç‰©ä¸»é¡µ) -->
            <div id="home" class="screen h-full p-6 text-white flex-col">
                <div class="flex justify-between items-center relative z-10">
                    <div class="flex items-center gap-2 bg-black/20 px-3 py-1.5 rounded-full"><i data-lucide="star" class="w-5 h-5 text-yellow-300 fill-yellow-400"></i><span class="font-bold text-white text-body">1,640</span></div>
                    <div class="flex items-center gap-4"><button onclick="navigate('notifications')"><i data-lucide="bell" class="text-[var(--color-starlight-blue)]"></i></button><button onclick="navigate('settings')"><i data-lucide="settings" class="text-[var(--color-starlight-blue)]"></i></button></div>
                </div>
                
                <div id="pet-display-area" class="flex-grow flex flex-col items-center justify-center text-center -mt-8 relative transition-all duration-500 rounded-3xl p-4">
                    <div class="relative">
                        <img src="https://placehold.co/256x256/23255A/EDEFF7?text=O.O&font=lora" alt="å¯çˆ±çš„AIç¡çœ å® ç‰©" class="w-64 breathing-pet rounded-full" onclick="navigate('pet-customization')">
                        <div id="prop-overlay-container" class="absolute inset-0 flex items-center justify-center pointer-events-none"></div>
                    </div>
                    <h2 class="text-h2 mt-4">O.O æ­£åœ¨ä¼‘æ¯</h2>
                    <button onclick="showPropsModal()" class="absolute bottom-4 left-4 bg-black/20 backdrop-blur-sm rounded-full w-12 h-12 p-0 flex items-center justify-center shadow-lg hover:bg-black/40 transition-colors">
                        <i data-lucide="shirt" class="w-6 h-6 text-white"></i>
                    </button>
                    <button onclick="showBackgroundModal()" class="absolute bottom-4 right-4 bg-black/20 backdrop-blur-sm rounded-full w-12 h-12 p-0 flex items-center justify-center shadow-lg hover:bg-black/40 transition-colors">
                        <i data-lucide="image" class="w-6 h-6 text-white"></i>
                    </button>
                </div>
                
                <div class="space-y-3 mt-4">
                     <div class="card w-full p-4 relative overflow-hidden" style="background: linear-gradient(135deg, #f97316 0%, #4f46e5 100%);" onclick="navigate('store')">
                        <div class="relative z-10">
                            <h3 class="text-title font-bold text-white">ä¸‡åœ£èŠ‚é™å®šè£…æ‰®</h3>
                            <p class="text-caption text-white/80">ç‚¹å‡»æŸ¥çœ‹ O.O çš„æ–°è¡£æœï¼</p>
                        </div>
                        <i data-lucide="ghost" class="absolute -right-4 -bottom-6 w-28 h-28 text-black/20 opacity-70 rotate-[-15deg]"></i>
                    </div>
                    <button onclick="showSleepModal()" class="btn btn-primary w-full"><i data-lucide="power" class="mr-2"></i>å¼€å§‹ç¡çœ </button>
                </div>
            </div>
            
            <!-- Sleep Center (Tab 2) -->
            <div id="sleep" class="screen h-full p-6 text-white flex-col overflow-y-auto space-y-6">
                <h1 class="text-h2">ç¡çœ ä¸­å¿ƒ</h1>
                
                <!-- Calendar Component -->
                <div>
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-title">ç¡çœ æ—¥å†</h2>
                        <div class="flex items-center gap-3 text-caption">
                            <span class="flex items-center gap-1.5"><div class="w-2 h-2 rounded-full bg-[var(--color-brand-purple)]"></div>ä¼˜ç§€</span>
                            <span class="flex items-center gap-1.5"><div class="w-2 h-2 rounded-full bg-[var(--color-soft-blue)]"></div>è‰¯å¥½</span>
                            <span class="flex items-center gap-1.5"><div class="w-2 h-2 rounded-full bg-gray-500"></div>ä¸€èˆ¬</span>
                        </div>
                    </div>
                    <div class="card p-4">
                        <div class="flex justify-between items-center mb-3">
                             <i data-lucide="chevron-left" class="text-[var(--color-text-weak)]"></i>
                             <p class="font-bold">2025å¹´ 10æœˆ</p>
                             <i data-lucide="chevron-right" class="text-[var(--color-text-weak)]"></i>
                        </div>
                        <div id="calendar-grid" class="grid grid-cols-7 gap-y-2 text-center text-sm">
                           <!-- Calendar will be generated by JS -->
                        </div>
                    </div>
                </div>

                <!-- White Noise Component -->
                <div>
                    <h2 class="text-title mb-3">ç™½å™ªéŸ³</h2>
                    <div id="noise-options-container" class="flex gap-4 overflow-x-auto pb-2 -mx-6 px-6">
                         <div data-noise-id="none" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-transparent">
                            <i data-lucide="volume-x" class="w-8 h-8 text-gray-400"></i>
                            <p class="mt-2 text-sm font-bold">æ— </p>
                         </div>
                         <div data-noise-id="rain" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-[var(--color-brand-purple)]">
                            <i data-lucide="cloud-rain" class="w-8 h-8 text-blue-300"></i>
                            <p class="mt-2 text-sm font-bold">é›¨å¤œ</p>
                         </div>
                         <div data-noise-id="wind" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-transparent">
                            <i data-lucide="wind" class="w-8 h-8 text-gray-300"></i>
                            <p class="mt-2 text-sm">é£å£°</p>
                         </div>
                         <div data-noise-id="waves" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-transparent">
                            <i data-lucide="waves" class="w-8 h-8 text-cyan-300"></i>
                            <p class="mt-2 text-sm">æµ·æµª</p>
                         </div>
                         <div data-noise-id="fire" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-transparent">
                            <i data-lucide="flame" class="w-8 h-8 text-orange-300"></i>
                            <p class="mt-2 text-sm">ç¯ç«</p>
                         </div>
                          <div data-noise-id="train" class="noise-option cursor-pointer flex-shrink-0 card text-center p-4 w-24 h-24 flex flex-col justify-center items-center border-2 border-transparent">
                            <i data-lucide="train-track" class="w-8 h-8 text-gray-400"></i>
                            <p class="mt-2 text-sm">åˆ—è½¦</p>
                         </div>
                    </div>
                </div>

                 <!-- Routine Planner Card -->
                <div class="card" onclick="navigate('routine-planner')">
                    <div class="flex items-center">
                        <div class="ios-list-icon bg-purple-500"><i data-lucide="calendar-clock"></i></div>
                        <div><p class="text-body font-bold">ä½œæ¯ç®¡ç†</p><p class="text-caption">O.O çš„ä¸“å±åŠ¨ç”»æé†’</p></div>
                        <i data-lucide="chevron-right" class="ml-auto text-[var(--color-text-weak)]"></i>
                    </div>
                </div>
            </div>

            <!-- E. Sleep Competing -->
            <div id="competing" class="screen h-full p-6 text-white flex-col">
                 <div class="flex justify-between items-center mb-6">
                    <h1 class="text-h2">ç¡çœ ç«èµ›</h1>
                    <button onclick="navigate('badge-gallery')">
                        <i data-lucide="award" class="text-[var(--color-starlight-blue)] w-6 h-6"></i>
                    </button>
                </div>

                <div class="flex bg-black/20 p-1 rounded-lg mb-4" id="leaderboard-tabs">
                    <button class="tab-btn active flex-1 p-2 rounded-md text-sm font-bold">å¥½å‹</button>
                    <button class="tab-btn flex-1 p-2 rounded-md text-sm font-bold">å…¨çƒ</button>
                </div>
                
                 <div class="card p-4 space-y-3">
                    <div class="flex items-center gap-4">
                        <span class="text-xl w-6 text-center">ğŸ¥‡</span> 
                        <img src="https://placehold.co/40x40/FBBF24/0E0F2D?text=ğŸ±" alt="Aliceçš„å® ç‰©" class="w-10 h-10 rounded-full">
                        <p class="text-body font-bold flex-grow">Alice</p>
                        <p class="text-lg font-semibold">95åˆ†</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-xl w-6 text-center">ğŸ¥ˆ</span>
                        <img src="https://placehold.co/40x40/23255A/EDEFF7?text=O.O&font=lora" alt="ä½ çš„å® ç‰©" class="w-10 h-10 rounded-full object-cover bg-white/10 p-0.5">
                        <p class="text-body font-bold flex-grow">ä½ </p>
                        <p class="text-lg font-semibold">88åˆ†</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-xl w-6 text-center">ğŸ¥‰</span>
                        <img src="https://placehold.co/40x40/F87171/0E0F2D?text=ğŸ¦Š" alt="Bobçš„å® ç‰©" class="w-10 h-10 rounded-full">
                        <p class="text-body font-bold flex-grow">Bob</p>
                        <p class="text-lg font-semibold">85åˆ†</p>
                    </div>
                 </div>

                 <div class="card mt-6 p-4 text-center">
                    <h3 class="text-title">å¥½å‹ç»„é˜Ÿç¡çœ </h3>
                    <p class="text-caption mt-1 mb-4">é‚€è¯·å¥½å‹ä¸€èµ·å®Œæˆç›®æ ‡ï¼Œèµ¢å–é¢å¤–å¥–åŠ±ï¼</p>
                    <button class="btn btn-secondary w-full"><i data-lucide="users" class="mr-2"></i>åˆ›å»ºé˜Ÿä¼</button>
                 </div>
            </div>
            
            <!-- In Sleep -->
            <div id="in-sleep" class="screen h-full bg-[#000] text-white p-6 flex-col items-center justify-center relative">
                 <img src="https://placehold.co/192x192/000000/EDEFF7?text=O.O&font=lora" alt="æ²‰ç¡ä¸­çš„AIå® ç‰©" class="w-48 breathing-pet opacity-80 rounded-full">
                 <div class="flex justify-around w-full max-w-xs mt-8">
                     <div class="text-center">
                         <p class="text-caption">ä½ çš„å¿ƒç‡</p>
                         <div class="flex items-center justify-center gap-2 mt-1">
                             <i data-lucide="heart-pulse" class="w-6 h-6 text-red-400 animate-pulse"></i>
                             <p id="user-heart-rate" class="text-h2 font-bold" style="font-variant-numeric: tabular-nums;">--</p>
                         </div>
                     </div>
                     <div class="text-center">
                         <p class="text-caption">O.Oçš„å¿ƒç‡</p>
                         <div class="flex items-center justify-center gap-2 mt-1">
                             <i data-lucide="heart-pulse" class="w-6 h-6 text-purple-400 animate-pulse"></i>
                             <p id="pet-heart-rate" class="text-h2 font-bold" style="font-variant-numeric: tabular-nums;">--</p>
                         </div>
                     </div>
                 </div>
                 <div class="absolute bottom-24 text-center">
                      <p class="text-h1" id="sleep-timer" style="font-variant-numeric: tabular-nums;">00:00:00</p>
                      <p class="text-body text-[var(--color-text-weak)]">æ­£åœ¨è®°å½•ç¡çœ ...</p>
                 </div>
                  <button onclick="endSleep()" class="absolute bottom-10 bg-red-500/50 backdrop-blur-sm text-white font-bold py-4 px-8 rounded-full">é•¿æŒ‰ç»“æŸ</button>
            </div>

            <!-- Morning Summary -->
            <div id="morning-summary" class="screen h-full p-6 text-white flex-col overflow-y-auto space-y-4">
                <div class="text-center pt-4">
                    <img src="https://placehold.co/96x96/23255A/EDEFF7?text=Stretch!&font=lora" class="w-24 mx-auto rounded-full" alt="Stretching Pet">
                    <h1 class="text-h1 mt-4">æ—©ä¸Šå¥½ï¼</h1>
                    <p class="text-body text-[var(--color-text-secondary)]">O.O é™ªä½ åº¦è¿‡äº†åˆä¸€ä¸ªå®‰ç¨³çš„å¤œæ™šã€‚</p>
                </div>
                
                <div class="card text-center">
                    <p class="text-caption">æœ¬æ¬¡ç¡çœ è·å¾—</p>
                    <div class="flex items-center justify-center gap-2 mt-2">
                        <i data-lucide="star" class="w-8 h-8 text-yellow-300 fill-yellow-400"></i>
                        <span class="text-h1 font-bold text-white">+360</span>
                        <span class="text-xs bg-yellow-500/30 text-yellow-300 font-bold px-1.5 py-0.5 rounded-md">x3</span>
                    </div>
                </div>
                
                <div class="card w-full p-4 space-y-4">
                    <div class="flex justify-between items-baseline"><span class="text-title">ç¡çœ åˆ†æ•°</span><span class="text-h1">88<span class="text-sm">åˆ†</span></span></div>
                    <div class="flex justify-between items-baseline"><span class="text-body">ç¡çœ æ—¶é•¿</span><span class="text-h2">8h 15m</span></div>
                    <div class="flex justify-between items-baseline"><span class="text-body">æ·±ç¡å æ¯”</span><span class="text-h2">25%</span></div>
                </div>
                
                <div class="card w-full p-4">
                    <div class="flex items-center mb-4">
                        <div class="ios-list-icon bg-red-500"><i data-lucide="mic"></i></div>
                        <div>
                            <p class="text-body font-bold">æ¢¦è¯ä¸å‘¼å™œ</p>
                            <p class="text-caption">O.O å¬åˆ°äº†è¿™äº›...</p>
                        </div>
                    </div>
            
                    <div class="bg-purple-900/50 rounded-lg p-3 mb-4 relative">
                         <p class="text-sm italic">"ä¸»äººï¼Œä½ æ˜¨æ™šå¥½åƒåœ¨è¯´'å†æ¥ä¸€ä¸ªç”œç”œåœˆ'...å¬å¾—æˆ‘éƒ½é¥¿äº†ï¼ğŸ˜´"</p>
                         <div class="absolute -bottom-2 left-4 w-0 h-0 border-l-8 border-l-transparent border-r-8 border-r-transparent border-t-8 border-t-purple-900/50"></div>
                    </div>
            
                    <div class="ios-list !bg-transparent !rounded-none -mx-4 -mb-4">
                        <div class="ios-list-item border-t border-t-white/10"><div class="ios-list-icon bg-red-400/50"><i data-lucide="play"></i></div><div><p>å½•éŸ³ 1: "...å†æ¥ä¸€ä¸ª..."</p><p class="text-caption">02:34 AM Â· 8ç§’</p></div></div>
                        <div class="ios-list-item"><div class="ios-list-icon bg-red-400/50"><i data-lucide="play"></i></div><div><p>å½•éŸ³ 2: (è½»å¾®çš„å‘¼å™œå£°)</p><p class="text-caption">03:15 AM Â· 12ç§’</p></div></div>
                    </div>
                </div>
                
                <button onclick="navigate('home', document.querySelector('.nav-item'))" class="btn btn-primary w-full mt-auto">å®Œæˆ</button>
            </div>
            
            <!-- Settings Page -->
            <div id="settings" class="screen h-full p-6 text-white flex-col">
                <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8">è®¾ç½®</h1></div>
                <div class="space-y-6"><div class="ios-list"><div class="ios-list-item"><div class="ios-list-icon bg-yellow-500"><i data-lucide="gem"></i></div><div><p>O.O Plus ä¼šå‘˜</p><p class="text-caption">å·²æ¿€æ´»</p></div></div></div><div class="ios-list"><div class="ios-list-item"><div class="ios-list-icon bg-purple-500"><i data-lucide="user-cog"></i></div><p>è´¦æˆ·</p><i data-lucide="chevron-right" class="ml-auto text-[var(--color-text-weak)]"></i></div><div class="ios-list-item"><div class="ios-list-icon bg-green-500"><i data-lucide="heart-pulse"></i></div><p>è¿æ¥åˆ° "å¥åº·"</p><i data-lucide="chevron-right" class="ml-auto text-[var(--color-text-weak)]"></i></div></div><div class="ios-list"><div class="ios-list-item"><div class="ios-list-icon bg-blue-500"><i data-lucide="app-window"></i></div><p>å°ç»„ä»¶ä¸çµåŠ¨å²›</p><i data-lucide="chevron-right" class="ml-auto text-[var(--color-text-weak)]"></i></div></div></div>
            </div>

            <!-- Other Pages (Stubs) -->
            <div id="notifications" class="screen h-full p-6 text-white flex-col">
                 <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8">é€šçŸ¥</h1></div>
                 <p class="text-center text-[var(--color-text-secondary)]">è¿™é‡Œè¿˜æ²¡æœ‰é€šçŸ¥</p>
            </div>
            <div id="pet-customization" class="screen h-full p-6 text-white flex-col">
                <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8">AI å® ç‰©å®šåˆ¶</h1></div>
                <p class="text-center text-caption mb-4">é€šè¿‡ AI ç”Ÿæˆä½ ç‹¬ä¸€æ— äºŒçš„ç¡çœ ä¼™ä¼´</p>
                <div class="card"><p class="text-body font-bold">å½¢æ€</p><p class="text-caption">å½“å‰ï¼šAIèŒå® </p></div>
                <div class="card mt-4"><p class="text-body font-bold">è¯­éŸ³</p><p class="text-caption">å½“å‰ï¼šæ¸©æŸ”å¥³å£°</p></div>
            </div>
            <div id="store" class="screen h-full p-6 text-white flex-col">
                <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8">å•†åº—</h1></div>
                <div class="card bg-cover bg-center" style="background-image: url('https://placehold.co/600x300/6C63FF/FFFFFF?text=é™å®šæ´»åŠ¨')"><p class="text-title font-bold">ä¸‡åœ£èŠ‚é™å®šè£…æ‰®</p></div>
            </div>
            <div id="sleep-analysis-detail" class="screen h-full p-6 text-white flex-col">
                <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8">æ¢¦è¯ä¸å‘¼å™œ</h1></div>
                <div class="ios-list"><div class="ios-list-item"><div class="ios-list-icon bg-red-400"><i data-lucide="play"></i></div><div><p>å½•éŸ³ 1</p><p class="text-caption">02:34 AM Â· 8ç§’</p></div></div><div class="ios-list-item"><div class="ios-list-icon bg-red-400"><i data-lucide="play"></i></div><div><p>å½•éŸ³ 2</p><p class="text-caption">03:15 AM Â· 12ç§’</p></div></div></div>
            </div>
             <div id="routine-planner" class="screen h-full p-6 text-white flex-col">
                <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8">ä½œæ¯ç®¡ç†</h1></div>
                <div class="ios-list"><div class="ios-list-item"><p>å°±å¯æé†’</p><span class="ml-auto text-caption">23:00</span><i data-lucide="chevron-right" class="ml-2 text-[var(--color-text-weak)]"></i></div></div>
            </div>
            <div id="badge-gallery" class="screen h-full p-6 text-white flex-col">
                <div class="flex items-center mb-6"><button onclick="goBack()"><i data-lucide="chevron-left" class="w-8 h-8"></i></button><h1 class="text-h2 mx-auto pr-8">å¾½ç« æˆå°±</h1></div>
                <p class="text-center text-[var(--color-text-secondary)]">åœ¨è¿™é‡Œå±•ç¤ºä½ è·å¾—çš„å¾½ç« </p>
            </div>
        </main>

        <nav class="w-full bg-black/30 backdrop-blur-md border-t border-white/10 flex justify-around p-2">
            <button class="nav-item active flex-1 flex flex-col items-center justify-center p-1" onclick="navigate('home', this)"><i data-lucide="tent" class="nav-icon w-7 h-7 text-[var(--color-text-weak)]"></i><span class="nav-label text-xs text-[var(--color-text-weak)] mt-1">ä¸»é¡µ</span></button>
            <button class="nav-item flex-1 flex flex-col items-center justify-center p-1" onclick="navigate('sleep', this)"><i data-lucide="bed-double" class="nav-icon w-7 h-7 text-[var(--color-text-weak)]"></i><span class="nav-label text-xs text-[var(--color-text-weak)] mt-1">ç¡çœ </span></button>
            <button class="nav-item flex-1 flex flex-col items-center justify-center p-1" onclick="navigate('competing', this)"><i data-lucide="trophy" class="nav-icon w-7 h-7 text-[var(--color-text-weak)]"></i><span class="nav-label text-xs text-[var(--color-text-weak)] mt-1">ç«èµ›</span></button>
        </nav>

        <!-- Sleep Modal -->
        <div id="sleep-modal" class="modal-sheet rounded-t-3xl p-6 text-white flex-col">
            <div class="w-10 h-1.5 bg-gray-600 rounded-full mx-auto mb-6"></div><h2 id="modal-title" class="text-h2 text-center mb-6">å‡†å¤‡å…¥ç¡</h2>
            <div class="text-center my-auto"><p id="modal-countdown" class="text-h1" style="font-size: 80px;"></p><p id="modal-text" class="text-caption">å°†ä¸ºä½ æ’­æ”¾ç™½å™ªéŸ³ã€Œé›¨å¤œã€</p></div>
            <button onclick="startSleepNow()" class="btn btn-primary w-full mt-auto">ç«‹å³å¼€å§‹</button><button onclick="hideSleepModal()" class="btn btn-secondary w-full mt-2">å–æ¶ˆ</button>
        </div>

        <!-- Background Scene Modal -->
        <div id="background-modal" class="modal-sheet rounded-t-3xl p-6 text-white flex-col">
             <div class="w-10 h-1.5 bg-gray-600 rounded-full mx-auto mb-6"></div>
             <h2 class="text-h2 text-center mb-6">æ›´æ¢åœºæ™¯</h2>
             <div id="scene-options-container" class="grid grid-cols-2 gap-4 overflow-y-auto">
                <!-- Scenes will be generated by JS -->
             </div>
        </div>
        
        <!-- Props Modal -->
        <div id="props-modal" class="modal-sheet rounded-t-3xl p-6 text-white flex-col">
             <div class="w-10 h-1.5 bg-gray-600 rounded-full mx-auto mb-6"></div>
             <h2 class="text-h2 text-center mb-6">é“å…·ä¸è£…æ‰®</h2>
             <div id="prop-options-container" class="grid grid-cols-3 gap-4 overflow-y-auto">
                <!-- Props will be generated by JS -->
             </div>
        </div>

    </div>

    <script>
        lucide.createIcons();
        let sleepInterval, modalCountdownInterval, heartRateInterval;
        const navigationStack = ['onboarding'];
        
        const scenes = [
            { id: 'night_sky', name: 'é™è°§å¤œç©º', style: 'var(--color-bg-primary)', noiseId: 'none' },
            { id: 'dusk', name: 'è–„æš®æ£®æ—', style: 'linear-gradient(to top, #4338ca, #312e81)', noiseId: 'rain' },
            { id: 'twilight', name: 'æ·±é‚ƒæš®å…‰', style: 'linear-gradient(to top, #1e3a8a, #4c1d95)', noiseId: 'wind' },
            { id: 'aurora', name: 'æå…‰ä¹‹å¢ƒ', style: 'linear-gradient(to top, #0c4a6e, #7e22ce)', noiseId: 'waves' }
        ];

        const props = [
            { id: 'none', name: 'æ— ', icon: 'slash' },
            { id: 'hat', name: 'æ´¾å¯¹å¸½', imageUrl: 'https://placehold.co/80x80/ffffff/000000/png?text=%F0%9F%8E%89', style: 'position: absolute; top: 15%; left: 50%; width: 30%; transform: translateX(-50%) rotate(-15deg);' },
            { id: 'glasses', name: 'å¤ªé˜³é•œ', imageUrl: 'https://placehold.co/120x40/ffffff/000000/png?text=%F0%9F%98%8E', style: 'position: absolute; top: 40%; left: 50%; width: 45%; transform: translateX(-50%);' }
        ];

        function populateScenes() {
            const container = document.getElementById('scene-options-container');
            if (!container) return;
            container.innerHTML = '';
            scenes.forEach(scene => {
                const sceneEl = document.createElement('div');
                sceneEl.className = 'text-center cursor-pointer';
                sceneEl.onclick = () => selectScene(scene.id);
                sceneEl.innerHTML = `
                    <div class="w-full h-24 rounded-lg mb-2" style="background: ${scene.style};"></div>
                    <p class="text-body font-bold">${scene.name}</p>
                `;
                container.appendChild(sceneEl);
            });
        }
        
        function populateProps() {
            const container = document.getElementById('prop-options-container');
            if (!container) return;
            container.innerHTML = '';
            props.forEach(prop => {
                const propEl = document.createElement('div');
                propEl.className = 'text-center cursor-pointer card !p-2';
                propEl.onclick = () => selectProp(prop.id);
                let iconHtml = prop.imageUrl 
                    ? `<img src="${prop.imageUrl}" class="w-16 h-16 mx-auto object-contain">`
                    : `<div class="w-16 h-16 mx-auto flex items-center justify-center"><i data-lucide="${prop.icon}" class="w-8 h-8 text-gray-400"></i></div>`;
                propEl.innerHTML = `
                    ${iconHtml}
                    <p class="text-caption mt-1">${prop.name}</p>
                `;
                container.appendChild(propEl);
            });
            lucide.createIcons();
        }

        function selectScene(sceneId) {
            const scene = scenes.find(s => s.id === sceneId);
            if (!scene) return;
            const displayArea = document.getElementById('pet-display-area');
            if (displayArea) {
                displayArea.style.background = scene.style;
            }
            const noiseOption = document.querySelector(`.noise-option[data-noise-id="${scene.noiseId}"]`);
            if (noiseOption) {
                 document.querySelectorAll('.noise-option').forEach(option => {
                    option.classList.remove('border-[var(--color-brand-purple)]');
                    option.classList.add('border-transparent');
                });
                noiseOption.classList.add('border-[var(--color-brand-purple)]');
                noiseOption.classList.remove('border-transparent');
            }
            hideBackgroundModal();
        }

        function selectProp(propId) {
            const prop = props.find(p => p.id === propId);
            if (!prop) return;
            const container = document.getElementById('prop-overlay-container');
            if (!container) return;
            container.innerHTML = '';
            if (prop.id !== 'none') {
                container.innerHTML = `<img src="${prop.imageUrl}" style="${prop.style}">`;
            }
            hidePropsModal();
        }

        function showBackgroundModal() { document.getElementById('modal-overlay').classList.add('show'); document.getElementById('background-modal').classList.add('show'); }
        function hideBackgroundModal() { document.getElementById('modal-overlay').classList.remove('show'); document.getElementById('background-modal').classList.remove('show'); }
        function showPropsModal() { document.getElementById('modal-overlay').classList.add('show'); document.getElementById('props-modal').classList.add('show'); }
        function hidePropsModal() { document.getElementById('modal-overlay').classList.remove('show'); document.getElementById('props-modal').classList.remove('show'); }

        function navigate(screenId, navElement) {
            const currentScreen = navigationStack[navigationStack.length - 1];
            if (screenId === currentScreen && navElement) return; 

            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            
            if (navElement) {
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                navElement.classList.add('active');
                navigationStack.length = 1;
                navigationStack[0] = screenId;
            } else {
                 if (navigationStack[navigationStack.length - 1] !== screenId) {
                    navigationStack.push(screenId);
                 }
            }
        }

        function goBack() {
            if (navigationStack.length <= 1) return;
            navigationStack.pop();
            const previousScreen = navigationStack[navigationStack.length - 1];
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(previousScreen).classList.add('active');
        }
        
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            if (!calendarGrid) return;
            calendarGrid.innerHTML = '';
            const daysOfWeek = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            daysOfWeek.forEach(day => {
                calendarGrid.insertAdjacentHTML('beforeend', `<div class="text-center text-caption font-bold">${day}</div>`);
            });
            const firstDayOffset = 3; 
            for (let i = 0; i < firstDayOffset; i++) {
                calendarGrid.insertAdjacentHTML('beforeend', '<div></div>');
            }
            const today = 22;
            const daysInMonth = 31;
            for (let day = 1; day <= daysInMonth; day++) {
                let dayClass = 'relative h-8 w-8 flex items-center justify-center mx-auto rounded-full';
                if (day < today) {
                    const sleepScore = 50 + Math.random() * 50;
                    if (sleepScore >= 90) dayClass += ' border-2 border-[var(--color-brand-purple)]';
                    else if (sleepScore >= 75) dayClass += ' border-2 border-[var(--color-soft-blue)]';
                    else dayClass += ' border-2 border-gray-500';
                }
                if (day === today) dayClass += ' bg-[var(--color-brand-purple)] text-white font-bold';
                calendarGrid.insertAdjacentHTML('beforeend', `<div class="${dayClass}">${day}</div>`);
            }
        }
        
        function showSleepModal() { document.getElementById('modal-overlay').classList.add('show'); document.getElementById('sleep-modal').classList.add('show'); let countdown = 5; document.getElementById('modal-countdown').textContent = countdown; modalCountdownInterval = setInterval(() => { countdown--; document.getElementById('modal-countdown').textContent = countdown; if (countdown === 0) startSleepNow(); }, 1000); }
        function hideSleepModal() { document.getElementById('modal-overlay').classList.remove('show'); document.getElementById('sleep-modal').classList.remove('show'); }
        function hideAllModals() { hideSleepModal(); hideBackgroundModal(); hidePropsModal(); }
        
        function startSleepNow() {
            clearInterval(modalCountdownInterval);
            hideSleepModal();
            navigate('in-sleep');
            let secondsSlept = 0;
            const timerDisplay = document.getElementById('sleep-timer');
            sleepInterval = setInterval(() => {
                secondsSlept++;
                const h = String(Math.floor(secondsSlept / 3600)).padStart(2, '0');
                const m = String(Math.floor((secondsSlept % 3600) / 60)).padStart(2, '0');
                const s = String(secondsSlept % 60).padStart(2, '0');
                timerDisplay.textContent = `${h}:${m}:${s}`;
                if (secondsSlept > 5) {
                    endSleep();
                }
            }, 1000);

            heartRateInterval = setInterval(() => {
                const userHr = document.getElementById('user-heart-rate');
                const petHr = document.getElementById('pet-heart-rate');
                if (userHr) userHr.textContent = Math.floor(60 + Math.random() * 10);
                if (petHr) petHr.textContent = Math.floor(65 + Math.random() * 10);
            }, 2000);
        }

        function endSleep() {
            clearInterval(sleepInterval);
            clearInterval(heartRateInterval);
            navigate('morning-summary');
        }

        document.addEventListener('DOMContentLoaded', () => { 
            document.getElementById('onboarding').classList.add('active');
            generateCalendar();
            populateScenes();
            populateProps();

            const noiseContainer = document.getElementById('noise-options-container');
            if(noiseContainer) {
                noiseContainer.addEventListener('click', (e) => {
                    const selectedCard = e.target.closest('.noise-option');
                    if (!selectedCard) return;
                    document.querySelectorAll('.noise-option').forEach(option => {
                        option.classList.remove('border-[var(--color-brand-purple)]');
                        option.classList.add('border-transparent');
                    });
                    selectedCard.classList.add('border-[var(--color-brand-purple)]');
                    selectedCard.classList.remove('border-transparent');
                });
            }

            const tabsContainer = document.getElementById('leaderboard-tabs');
            if(tabsContainer) {
                tabsContainer.addEventListener('click', (e) => {
                    const selectedTab = e.target.closest('.tab-btn');
                    if(!selectedTab) return;
                    tabsContainer.querySelectorAll('.tab-btn').forEach(tab => tab.classList.remove('active'));
                    selectedTab.classList.add('active');
                });
            }
        });
    </script>
</body>
</html>

